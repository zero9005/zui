<!-- https://lbs.qq.com/guides/place_search.html -->
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="../css/base.css" />
		<style>
			.search-input-wrap {
				padding: 5px;
				display: flex;
			}
			.search-input-wrap label {
				padding: 5px;
				margin-right: 10px;
			}
			.search-input-wrap input {
				flex: 1;
				border: none;
				border-bottom: 1px solid #ccc;
			}
			.container {
				padding: 5px;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="search-input-wrap">
				<label class="fs-12">东莞</label>
				<input placeholder="请输入关键字" oninput="searchInputEvent(event)" autocomplete="on" />
			</div>
		</div>
		
		<script src="../js/jquery-2.1.3.min.js"></script>
		<script>
			var region = '东莞'
			var key = 'XXSBZ-DUAEX-XYR4Y-TKLAY-EHJEQ-2TB34'
			function searchInputEvent(event) {
				var keyword = event.target.value
				if (keyword.trim() == '') return
				var url = `https://apis.map.qq.com/ws/place/v1/suggestion?key=${key}&region=${region}&keyword=${keyword}`
				// $.get(url, function(res) {
				// 	console.log(res)
				// })
				ajax({
					url: url,
					headers: {
						'Access-Control-Allow-Origin': '*'
					},
					success: function(res) {
						console.log(res)
					}
				})
			}
			
			function ajax(options) {
				var xhr = new XMLHttpRequest()
				xhr.onreadystatechange = function() {
					if (xhr.readyState == 4 && xhr.status == 200) {
						options.success(xhr.responseText)
					} else if (xhr.readyState == 4 && xhr.status != 200) {
						options.error()
					}
				}
				
				var urlStr = ''
				for (var key in options.data) {
					urlStr = key + '=' + options.data[key] + '&'
				}
				urlStr = urlStr.substring(0, urlStr.length - 1)
				
				var type = options.type || 'get'
				type = type.toLocaleLowerCase()
				var async = options.async || true
				
				var url = options.url
				
				if (type === 'get') {
					url = url + '?' + urlStr
				} else if (type === 'post') {
					xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
				}
				
				xhr.open(type, url, async)
				
				if (options.headers) {
					for (var key in options.headers) {
						xhr.setRequestHeader(key, options.headers[key])
					}
				}
				
				if (type === 'get') {
					xhr.send()
				} else {
					xhr.send(urlStr)
				}
			}
		</script>
		
	</body>
</html>
